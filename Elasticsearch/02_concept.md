## the concept in elasticsearch
[Elasticsearch(4)--- 基本概念(Index、Type、Document、集群、节点、分片及副本、倒排索引)](https://www.cnblogs.com/qdhxhz/p/11448451.html)

### 简介

1. elasticsearch是一个分布式的文档存储；
2. 其存储的不是行列数据，而是序列化为json文档的复杂数据结构；
3. 接近实时搜索——在1s以内（因为使用inverted index数据结构，其支持非常快的全文搜索）；

### document

**Document** ：Index 里面单条的记录称为Document（文档）。等同于关系型数据库表中的行。

### indice
### shard/分片

#### Primary Shard/主分片
ES中的shard用来解决节点的容量上限问题,，通过主分片，可以将数据分布到集群内的所有节点之上。

它们之间关系：

 1. 一个节点对应一个ES实例；
 2. 一个节点可以有多个index（索引）;
 3. 一个index可以有多个shard（分片）；
4. 一个分片是一个lucene index（此处的index是lucene自己的概念，与ES的index不是一回事）；

**主分片数是在索引创建时指定，后续不允许修改，除非Reindex
**

一个索引中的数据保存在多个分片中(默认为一个)，相当于水平分表。一个分片便是一个Lucene 的实例，它本身就是一个完整的搜索引擎。我们的文档被存储和索引到分片内，

但是应用程序是直接与索引而不是与分片进行交互。

#### Replica Shard/副分片

副本有两个重要作用：

1. **服务高可用**：由于数据只有一份,如果一个node挂了,那存在上面的数据就都丢了,有了replicas,只要不是存储这条数据的node全挂了,数据就不会丢。因此分片副本不会与主分片分配到同一个节点；
2. **扩展性能**：通过在所有replicas上并行搜索提高搜索性能.由于replicas上的数据是近实时的(near realtime),因此所有replicas都能提供搜索功能,通过设置合理的replicas数量可以极高的提高搜索吞吐量

#### 分片的设定

对于生产环境中分片的设定，需要提前做好容量规划，因为主分片数是在索引创建时预先设定的，后续无法修改。

 1. **分片数设置过小**
    1. 导致后续无法增加节点进行水平扩展。
    2. 导致分片的数据量太大，数据在重新分配时耗时；
 2. **分片数设置过大**
    1. 影响搜索结果的相关性打分，影响统计结果的准确性；
    2. 单个节点上过多的分片，会导致资源浪费，同时也会影响性能；

### node/节点

 1. 节点是什么？
    1. 节点是一个ElasticSearch的实例，其本质就是一个Java进程；
    2. 一台机器上可以运行多个ElasticSearch实例，但是建议在生产环境中一台机器上只运行一个ElasticSearch实例；
2. Node 是组成集群的一个单独的服务器，用于存储数据并提供集群的搜索和索引功能。与集群一样，节点也有一个唯一名字，默认在节点启动时会生成一个uuid作为节点名，
3. 该名字也可以手动指定。单个集群可以由任意数量的节点组成。如果只启动了一个节点，则会形成一个单节点的集群。

### cluster/集群
ElasticSearch集群实际上是一个分布式系统，它需要具备两个特性：

1. `高可用性`
    1. 服务可用性：允许有节点停止服务；
    2. 数据可用性：部分节点丢失，不会丢失数据；
2. `可扩展性`
    1. 随着请求量的不断提升，数据量的不断增长，系统可以将数据分布到其他节点，实现水平扩展；

**一个集群中可以有一个或者多个节点；**

**集群健康值**

1. green：所有主要分片和复制分片都可用
2. yellow：所有主要分片可用，但不是所有复制分片都可用
3. red：不是所有的主要分片都可用;**当集群状态为 red，它仍然正常提供服务，它会在现有存活分片中执行请求，我们需要尽快修复故障分片，防止查询数据的丢失；**
    
### inverted index/倒排索引

## the concept in kibana